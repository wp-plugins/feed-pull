(function(e,n,a){"use strict";var t=function(){function t(){function t(){return w.find("tr").last().attr("data-mapping-row-id")}function i(){return _.find("tr").last().attr("data-namespace-row-id")}function p(){e(this).parents("tr").fadeOut().remove()}function o(){function n(){e(this).remove(),1>_.find("tr").length&&m.hide()}e(this).parents("tr").fadeOut(400,n)}function l(){var e=parseInt(t())+1,a=n.template(I,{rowID:e});w.append(a)}function c(){var e=parseInt(i())+1,a=n.template(j,{rowID:e,namespace_prefix:"",namespace_url:""});_.append(a),m.show()}function r(){g.animate({opacity:1}),e.ajax({type:"post",url:ajaxurl,dataType:"json",data:{action:"pull",nonce:a.pull_nonce,source_feed_id:y.val()}}).always(function(){g.animate({opacity:0})})}function s(){e.ajax({type:"post",url:ajaxurl,dataType:"json",data:{action:"get_namespaces",nonce:a.get_namespaces_nonce,feed_url:x.val()}}).done(function(t){if(x.val()!==b)if(t.namespaces&&t.namespaces[""]!==undefined){d.html(a.unprefixed_root_namespace);var p=!0;if(_.find("input[type=text]").each(function(){("default"==e(this).val()||e(this).val()==t.namespaces[""])&&(p=!1)}),p){var o=parseInt(i())+1,l=n.template(j,{rowID:o,namespace_prefix:"default",namespace_url:t.namespaces[""]});_.append(l),m.show()}}else d.html(a.prefixed_root_namespace)}).always(function(){b=x.val()})}var u=e("#fp_field_mapping"),f=e("#fp_source_details"),d=f.find(".custom-namespaces-description"),m=f.find("table"),_=m.find("tbody"),v=u.find("table"),w=v.find("tbody"),h=e("#fp_manual_pull"),y=e("#post_ID"),g=e("#fp-spinner"),x=e("#fp_feed_url"),I=e("#mapping-row-template").html(),j=e("#namespace-row-template").html();e("#log-item-template").html();var b=null;s(),v.on("click","input.delete",p),u.on("click","input.add-new",l),m.on("click","input.delete",o),f.on("click","input.add-new",c),x.on("blur",s),h.on("click",r)}function i(){return null===p&&(p=new t),p}var p=null;return{getInstance:i}}();t.getInstance()})(jQuery,_,FP_Settings,window);